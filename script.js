const vocabListKhanh = [
   {"word": "awareness", "type": "n", "vietnamese": "sự nhận thức"},
    {"word": "carbon footprint", "type": "n", "vietnamese": "tổng lượng phát thải khí CO2"},
    {"word": "resource", "type": "n", "vietnamese": "nguồn tài nguyên"},
    {"word": "efficiently", "type": "adv", "vietnamese": "một cách hiệu quả"},
    {"word": "eco-friendly", "type": "adj", "vietnamese": "thân thiện với môi trường"},
    {"word": "decompose", "type": "v", "vietnamese": "phân hủy"},
    {"word": "reusable", "type": "adj", "vietnamese": "có thể tái sử dụng"},
    {"word": "single-use", "type": "adj", "vietnamese": "dùng một lần"},
    {"word": "ecotourism", "type": "n", "vietnamese": "du lịch sinh thái"},
    {"word": "waste", "type": "n", "vietnamese": "rác thải"},
    {"word": "landfill", "type": "n", "vietnamese": "bãi rác"},
    {"word": "reuse", "type": "v", "vietnamese": "tái sử dụng"},
    {"word": "packaging", "type": "n", "vietnamese": "bao bì"},
    {"word": "container", "type": "n", "vietnamese": "hộp, gói, thùng chứa"},
    {"word": "recyclable", "type": "adj", "vietnamese": "có thể tái chế"},
    {"word": "cardboard", "type": "n", "vietnamese": "bia cứng"},
    {"word": "cardboard", "type": "adj", "vietnamese": "làm bằng bìa cứng"},
    {"word": "leftover", "type": "n", "vietnamese": "thức ăn thừa"},
    {"word": "contaminated", "type": "adj", "vietnamese": "nhiễm độc, nhiễm khuẩn"},
    {"word": "compost", "type": "n", "vietnamese": "phân hữu cơ"},
    {"word": "sort", "type": "v", "vietnamese": "phân loại"},
    {"word": "layer", "type": "n", "vietnamese": "tầng, lớp"},
    {"word": "household waste", "type": "n", "vietnamese": "rác thải sinh hoạt"},
    {"word": "fruit peel", "type": "n", "vietnamese": "vỏ hoa quả"},
    {"word": "pile", "type": "n", "vietnamese": "đống"},
    {"word": "recycle", "type": "v", "vietnamese": "tái chế"},
    {"word": "sustainable", "type": "adj", "vietnamese": "bền vững, thân thiện môi trường"},
    {"word": "release", "type": "v", "vietnamese": "thải ra"},
   {"word": "multicultural", "type": "adj", "vietnamese": "đa văn hóa"},
    {"word": "cultural diversity", "type": "n", "vietnamese": "đa dạng văn hóa"},
    {"word": "cuisine", "type": "n", "vietnamese": "ẩm thực"},
    {"word": "booth", "type": "n", "vietnamese": "gian hàng"},
    {"word": "spicy", "type": "adj", "vietnamese": "cay"},
    {"word": "autograph", "type": "n", "vietnamese": "chữ ký của người nổi tiếng"},
    {"word": "souvenir", "type": "n", "vietnamese": "đồ lưu niệm"},
    {"word": "tug of war", "type": "n", "vietnamese": "trò chơi kéo co"},
    {"word": "bamboo dancing", "type": "n", "vietnamese": "nhảy sạp"},
    {"word": "delicious", "type": "adj", "vietnamese": "ngon miệng"},
    {"word": "identity", "type": "n", "vietnamese": "bản sắc, đặc điểm nhận dạng"},
    {"word": "origin", "type": "n", "vietnamese": "nguồn gốc"},
    {"word": "popularity", "type": "n", "vietnamese": "sự phổ biến"},
    {"word": "festival", "type": "n", "vietnamese": "lễ hội"},
    {"word": "trend", "type": "n", "vietnamese": "xu hướng"},
    {"word": "custom", "type": "n", "vietnamese": "phong tục"},
    {"word": "mystery", "type": "n", "vietnamese": "điều bí ẩn"},
    {"word": "globalisation", "type": "n", "vietnamese": "toàn cầu hóa"},
    {"word": "connected", "type": "adj", "vietnamese": "kết nối"},
    {"word": "respect", "type": "n", "vietnamese": "khía cạnh"},
    {"word": "dish", "type": "n", "vietnamese": "món ăn"},
    {"word": "ingredient", "type": "n", "vietnamese": "nguyên liệu, thành phần"},
    {"word": "unique", "type": "adj", "vietnamese": "độc đáo"},
    {"word": "specialty", "type": "n", "vietnamese": "đặc sản"},
    {"word": "captivate", "type": "v", "vietnamese": "thu hút, lôi cuốn"},
    {"word": "cross-cultural", "type": "adj", "vietnamese": "giao thoa văn hóa"},
    {"word": "blend", "type": "v", "vietnamese": "pha trộn"},
    {"word": "reflect", "type": "v", "vietnamese": "phản ánh"},
    {"word": "richness", "type": "n", "vietnamese": "sự phong phú"},
    {"word": "appreciate", "type": "v", "vietnamese": "thưởng thức, trân trọng"},
    {"word": "lifestyle", "type": "n", "vietnamese": "lối sống"},
    {"word": "celebrate", "type": "v", "vietnamese": "tổ chức, ăn mừng"},
   {"word": "admire", "type": "v", "vietnamese": "ngưỡng mộ"},
    {"word": "volunteer", "type": "v", "vietnamese": "tình nguyện"},
    {"word": "army", "type": "n", "vietnamese": "quân đội"},
    {"word": "surgeon", "type": "n", "vietnamese": "bác sĩ phẫu thuật"},
    {"word": "resistance war", "type": "n", "vietnamese": "cuộc kháng chiến"},
    {"word": "diary", "type": "n", "vietnamese": "nhật ký"},
    {"word": "field hospital", "type": "n", "vietnamese": "bệnh viện dã chiến"},
    {"word": "account", "type": "n", "vietnamese": "câu chuyện"},
    {"word": "experience", "type": "n", "vietnamese": "trải nghiệm"},
    {"word": "enemy", "type": "n", "vietnamese": "kẻ thù"},
    {"word": "duty", "type": "n", "vietnamese": "nghĩa vụ, nhiệm vụ"},
    {"word": "hero", "type": "n", "vietnamese": "anh hùng"},
    {"word": "devote", "type": "v", "vietnamese": "cống hiến"},
    {"word": "youth", "type": "n", "vietnamese": "tuổi trẻ"},
    {"word": "death", "type": "n", "vietnamese": "cái chết"},
    {"word": "attend", "type": "v", "vietnamese": "đi học, tham dự"},
    {"word": "childhood", "type": "n", "vietnamese": "tuổi thơ ấu"},
    {"word": "marriage", "type": "n", "vietnamese": "cuộc hôn nhân"},
    {"word": "impressive", "type": "adj", "vietnamese": "đầy ấn tượng"},
    {"word": "achievement", "type": "n", "vietnamese": "thành tựu"},
    {"word": "biological", "type": "adj", "vietnamese": "ruột thịt"},
    {"word": "adopt", "type": "v", "vietnamese": "nhận con nuôi"},
    {"word": "bond", "type": "n", "vietnamese": "kết thân, kết nối"},
    {"word": "accessible", "type": "adj", "vietnamese": "dễ tiếp cận"},
    {"word": "touchscreen", "type": "n", "vietnamese": "màn hình cảm ứng"},
    {"word": "cutting-edge", "type": "adj", "vietnamese": "hiện đại"},
    {"word": "stylish", "type": "adj", "vietnamese": "kiểu cách"},
    {"word": "animated", "type": "adj", "vietnamese": "hoạt hình"},
    {"word": "blockbuster", "type": "n", "vietnamese": "phim bom tấn"},
    {"word": "diagnose", "type": "v", "vietnamese": "chẩn đoán"},
    {"word": "rare", "type": "adj", "vietnamese": "hiếm"},
    {"word": "cancer", "type": "n", "vietnamese": "ung thư"}
];

const vocabListKhiem = [
   {"word": "admire",       "type": "v",   "vietnamese": "ngưỡng mộ"},
    {"word": "volunteer",    "type": "v",   "vietnamese": "tình nguyện"},
    {"word": "army",         "type": "n",   "vietnamese": "quân đội"},
    {"word": "surgeon",      "type": "n",   "vietnamese": "bác sĩ phẫu thuật"},
    {"word": "resistance",   "type": "n",   "vietnamese": "sự kháng chiến"},
    {"word": "war",          "type": "n",   "vietnamese": "chiến tranh"},
    {"word": "diary",        "type": "n",   "vietnamese": "nhật ký"},
    {"word": "field",        "type": "n",   "vietnamese": "chiến trường"},
    {"word": "hospital",     "type": "n",   "vietnamese": "bệnh viện"},
    {"word": "account",      "type": "n",   "vietnamese": "câu chuyện"},
    {"word": "experience",   "type": "n",   "vietnamese": "trải nghiệm"},
    {"word": "enemy",        "type": "n",   "vietnamese": "kẻ thù"},
    {"word": "duty",         "type": "n",   "vietnamese": "nghĩa vụ"},
    {"word": "hero",         "type": "n",   "vietnamese": "anh hùng"},
    {"word": "devote",       "type": "v",   "vietnamese": "cống hiến"},
    {"word": "youth",        "type": "n",   "vietnamese": "tuổi trẻ"},
    {"word": "death",        "type": "n",   "vietnamese": "cái chết"},
    {"word": "attend",       "type": "v",   "vietnamese": "tham dự"},
    {"word": "childhood",    "type": "n",   "vietnamese": "tuổi thơ ấu"},
    {"word": "marriage",     "type": "n",   "vietnamese": "cuộc hôn nhân"},
    {"word": "impressive",   "type": "adj", "vietnamese": "ấn tượng"},
    {"word": "achievement",  "type": "n",   "vietnamese": "thành tựu"},
    {"word": "display",      "type": "n",   "vietnamese": "sự trưng bày"},
    {"word": "lobby",        "type": "n",   "vietnamese": "sảnh"},
    {"word": "back",         "type": "n",   "vietnamese": "mặt sau"},
    {"word": "brochure",     "type": "n",   "vietnamese": "tờ rơi"},
    {"word": "senior",       "type": "adj", "vietnamese": "lớn tuổi"},
    {"word": "avenue",       "type": "n",   "vietnamese": "đại lộ"},
    {"word": "bargain",      "type": "n",   "vietnamese": "món hời"},
   {"word": "proper", "type": "adj", "vietnamese": "đúng, phù hợp"},
    {"word": "strict", "type": "adj", "vietnamese": "nghiêm khắc"},
    {"word": "rule", "type": "n", "vietnamese": "quy tắc"},
    {"word": "obey", "type": "v", "vietnamese": "tuân theo"},
    {"word": "fragile", "type": "adj", "vietnamese": "dễ vỡ, mong manh"},
    {"word": "exhibit", "type": "v", "vietnamese": "trưng bày"},
    {"word": "hand", "type": "v", "vietnamese": "trao, đưa"},
    {"word": "out", "type": "adv", "vietnamese": "ra ngoài"},
    {"word": "interactive", "type": "adj", "vietnamese": "tương tác"},
    {"word": "CD-ROM", "type": "n", "vietnamese": "đĩa CD-ROM"},
    {"word": "layout", "type": "n", "vietnamese": "bố cục"},
    {"word": "sequence", "type": "n", "vietnamese": "trình tự"},
    {"word": "cetera", "type": "n", "vietnamese": "những thứ khác, v.v."},
    {"word": "proposal", "type": "n", "vietnamese": "đề xuất"},
    {"word": "ought to", "type": "v", "vietnamese": "nên, phải"},
    {"word": "order", "type": "n", "vietnamese": "trật tự, thứ tự"},
    {"word": "typo", "type": "n", "vietnamese": "lỗi đánh máy"},
    {"word": "knock", "type": "v", "vietnamese": "gõ, đập"},
    {"word": "cloakroom", "type": "n", "vietnamese": "phòng giữ áo mũ"},
    {"word": "insert", "type": "v", "vietnamese": "chèn vào"},
    {"word": "subheading", "type": "n", "vietnamese": "tiêu đề phụ"},
    {"word": "sake", "type": "n", "vietnamese": "mục đích, lợi ích"},
    {"word": "format", "type": "n", "vietnamese": "định dạng"}
];
// Hardcoded login credentials
const credentials = {
  truong: "1234",
  khiem: "1234"
};

let currentVocabList = [];
let unseenWords = [];
let wrongQueue = [];
let currentWord = null;
let score = 0;
let hintIndex = 0;
let currentAttempt = 0;

// DOM Elements for login screen
const loginScreen = document.getElementById("login-screen");
const usernameInput = document.getElementById("username");
const passwordInput = document.getElementById("password");
const loginBtn = document.getElementById("login-btn");
const loginFeedback = document.getElementById("login-feedback");

// DOM Elements for quiz screen
const quizScreen = document.getElementById("quiz-screen");
const progressEl = document.getElementById("progress");
const vietnameseEl = document.getElementById("vietnamese");
const wordInput = document.getElementById("wordInput");
const typeInput = document.getElementById("typeInput");
const checkBtn = document.getElementById("check-btn");
const skipBtn = document.getElementById("skip-btn");
const feedbackEl = document.getElementById("feedback");

// Hai nút "gợi ý" mới và hai ô hiển thị gợi ý
const wordHintBtn = document.getElementById("word-hint-btn");
const letterHintEl = document.getElementById("letter-hint");
const typeHintBtn = document.getElementById("type-hint-btn");
const typeHintEl = document.getElementById("type-hint");

// Audio elements for sound effects
const correctSound = document.getElementById("correct-sound");
const wrongSound = document.getElementById("wrong-sound");

// Login function
function loginFunction() {
  const username = usernameInput.value.trim().toLowerCase();
  const password = passwordInput.value.trim();

  if (!(username in credentials)) {
    loginFeedback.textContent = "Wrong username.";
    loginFeedback.style.color = "red";
    return;
  }
  if (credentials[username] !== password) {
    loginFeedback.textContent = "Wrong password.";
    loginFeedback.style.color = "red";
    return;
  }
  
  loginFeedback.textContent = "Đăng nhập thành công!";
  loginFeedback.style.color = "green";
  // Set the vocabulary list based on the username
  currentVocabList = (username === "truong") ? vocabListKhanh : (username === "khiem") ? vocabListKhiem : [];
  startExam();
}

// Bind Enter key for login
usernameInput.addEventListener("keydown", function(e) {
  if (e.key === "Enter") loginFunction();
});
passwordInput.addEventListener("keydown", function(e) {
  if (e.key === "Enter") loginFunction();
});
loginBtn.addEventListener("click", loginFunction);

// Quiz event listeners
checkBtn.addEventListener("click", checkAnswer);
skipBtn.addEventListener("click", skipQuestion);

// Gợi ý dần từng chữ cái
wordHintBtn.addEventListener("click", showWordHint);
// Gợi ý loại từ
typeHintBtn.addEventListener("click", showTypeHint);

// Bind Enter key for submitting the answer
wordInput.addEventListener("keydown", function(e) {
  if (e.key === "Enter") checkAnswer();
});
typeInput.addEventListener("keydown", function(e) {
  if (e.key === "Enter") checkAnswer();
});

// Start the quiz after successful login
function startExam() {
  // Hide login screen and show quiz screen
  loginScreen.style.display = "none";
  quizScreen.style.display = "block";
  score = 0;
  unseenWords = [...currentVocabList];
  wrongStack = [];
  progressEl.textContent = `Đã đúng: ${score}/${currentVocabList.length}`;
  nextQuestion();
}

function nextQuestion() {
  // If no more cards, finish
  if (unseenWords.length === 0 && wrongQueue.length === 0) {
    return endQuiz();
  }

  // 1) If there are still unseen words, pick one at random
  if (unseenWords.length > 0) {
    const idx       = Math.floor(Math.random() * unseenWords.length);
    currentWord     = unseenWords.splice(idx, 1)[0];
  }
  // 2) Otherwise, dequeue from the front of wrongQueue
  else {
    currentWord = wrongQueue.shift();
  }

  // Reset hints + attempts
  currentAttempt = 0;
  hintIndex      = 0;

  // Show the Vietnamese meaning
  vietnameseEl.textContent = `Nghĩa: ${currentWord.vietnamese}`;

  // Clear input fields, feedback, and hints
  wordInput.value         = "";
  typeInput.value         = "";
  feedbackEl.textContent  = "";
  letterHintEl.textContent = "";
  typeHintEl.textContent   = "";
  wordInput.classList.remove("error");
  typeInput.classList.remove("error");

  wordInput.focus();
}

function showWordHint() {
  const correctWord = currentWord.word.toLowerCase();
  if (hintIndex < correctWord.length) {
    hintIndex++;
  }
  letterHintEl.textContent = correctWord.substring(0, hintIndex);
}

function showTypeHint() {
  // Hiển thị loại từ một lần (n, v, adj, adv...)
  typeHintEl.textContent = currentWord.type;
}

function skipQuestion() {
  wrongQueue.push(currentWord);
  nextQuestion();
}

function checkAnswer() {
  const userWord    = wordInput.value.trim().toLowerCase();
  const userType    = typeInput.value.trim().toLowerCase();
  const correctWord = currentWord.word.trim().toLowerCase();
  const correctType = currentWord.type.trim().toLowerCase();

  // Remove any old red‐border styling
  wordInput.classList.remove("error");
  typeInput.classList.remove("error");

  const wordIsRight = (userWord === correctWord);
  const typeIsRight = (userType === correctType);

  if (wordIsRight && typeIsRight) {
    // (A) Perfect first try → full point
    if (currentAttempt === 0 && hintIndex === 0) {
      feedbackEl.textContent = "Đúng!";
      feedbackEl.style.color = "green";
      score++;
      progressEl.textContent = `Đã đúng: ${score}/${currentVocabList.length}`;
      correctSound.play();

      // If by any chance it’s still in wrongQueue, remove it
      // const idxInQueue = wrongQueue.indexOf(currentWord);
      // if (idxInQueue !== -1) {
      //   wrongQueue.splice(idxInQueue, 1);
      // }
    }
    // (B) Right after a hint or wrong attempt → no point, re‐enqueue
    else {
      feedbackEl.textContent = "Đúng nhưng không tính điểm vì đã sai/gợi ý. Từ này sẽ xuất hiện lại.";
      feedbackEl.style.color = "orange";
      correctSound.play();
      wrongQueue.push(currentWord);
    }
    nextQuestion();
  } 
  else {
    // (C) At least one field is wrong right now
    if (!wordIsRight) {
      wordInput.classList.add("error");
    }
    if (!typeIsRight) {
      typeInput.classList.add("error");
    }
    currentAttempt++;
    wrongSound.play();
  }
}

function endQuiz() {
  vietnameseEl.textContent = "Kết thúc kiểm tra!";
  feedbackEl.textContent = `Điểm của bạn: ${score}`;
  wordInput.disabled = true;
  typeInput.disabled = true;
}



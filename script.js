const vocabListKhanh = [
   {"word": "demographic",   "type": "",  "vietnamese": "thuộc nhân khẩu học"},
       {"word": "trend",         "type": "n",    "vietnamese": "xu hướng"},
    {"word": "vogue",         "type": "n",    "vietnamese": "mốt; thịnh hành"},
    {"word": "accommodate",   "type": "v",    "vietnamese": "chứa đựng; đáp ứng"},
    {"word": "sacrifice",     "type": "v",    "vietnamese": "hi sinh"},
    {"word": "verdant",       "type": "adj",  "vietnamese": "xanh tươi"},
    {"word": "natural",       "type": "adj",  "vietnamese": "tự nhiên"},
    {"word": "ecozone",       "type": "n",    "vietnamese": "vùng sinh thái"},
    {"word": "semi-arid",     "type": "adj",  "vietnamese": "bán khô hạn"},
    {"word": "desert",        "type": "n",    "vietnamese": "sa mạc"},
    {"word": "monsoon",       "type": "n",    "vietnamese": "gió mùa"},
    {"word": "prohibitively", "type": "adv",  "vietnamese": "quá mức; (thường) đắt đỏ"},
    {"word": "aspiration",    "type": "n",    "vietnamese": "khát vọng"},
    {"word": "undoubted",     "type": "adj",  "vietnamese": "không thể nghi ngờ"},
    {"word": "detrimental",   "type": "adj",  "vietnamese": "có hại"},
    {"word": "dialogue",      "type": "n",    "vietnamese": "lời thoại"},
    {"word": "synchronous",   "type": "adj",  "vietnamese": "đồng bộ"},
    {"word": "asynchronous",  "type": "adj",  "vietnamese": "không đồng bộ"},
    {"word": "physiognomy",   "type": "n",    "vietnamese": "diện mạo (khuôn mặt)"},
    {"word": "gesture",       "type": "n",    "vietnamese": "cử chỉ"},
    {"word": "persona",       "type": "n",    "vietnamese": "nhân vật; (tính cách)"},
    {"word": "emerge",        "type": "v",    "vietnamese": "xuất hiện"},
    {"word": "banal",         "type": "adj",  "vietnamese": "tầm thường"},
    {"word": "intrinsic",     "type": "adj",  "vietnamese": "vốn có"},
    {"word": "interest",      "type": "n",    "vietnamese": "sự thú vị"},
    {"word": "inadequacy",    "type": "n",    "vietnamese": "sự thiếu sót"},
    {"word": "magnificent",   "type": "adj",  "vietnamese": "tráng lệ"},
    {"word": "portray",       "type": "v",    "vietnamese": "miêu tả"},
    {"word": "engage",        "type": "v",    "vietnamese": "thu hút"},
    {"word": "acknowledge",   "type": "v",    "vietnamese": "thừa nhận"},
    {"word": "nuance",        "type": "n",    "vietnamese": "sắc thái"},
    {"word": "depict",        "type": "v",    "vietnamese": "miêu tả"},
    {"word": "foreshadow",    "type": "v",    "vietnamese": "báo trước"},
    {"word": "salient",       "type": "adj",  "vietnamese": "nổi bật"},
    {"word": "comprise",      "type": "v",    "vietnamese": "bao gồm"},
   {"word": "persistence", "type": "n", "vietnamese": "sự dai dẳng"},
    {"word": "peril", "type": "n", "vietnamese": "nguy hiểm"},
    {"word": "interpersonal", "type": "adj", "vietnamese": "giữa các cá nhân"},
    {"word": "inadvertently", "type": "adv", "vietnamese": "vô ý, không cố ý"},
    {"word": "distribute", "type": "v", "vietnamese": "phân phối"},
    {"word": "widespread", "type": "adj", "vietnamese": "lan rộng, phổ biến"},
    {"word": "facilitate", "type": "v", "vietnamese": "tạo điều kiện, làm cho thuận lợi"},
    {"word": "unduly", "type": "adv", "vietnamese": "quá đáng, không hợp lý"},
    {"word": "misperception", "type": "n", "vietnamese": "nhận thức sai, hiểu sai"},
    {"word": "contemporary", "type": "adj", "vietnamese": "đương thời, hiện đại"},
    {"word": "warrant", "type": "v", "vietnamese": "đòi hỏi, cần thiết"},
    {"word": "encounter", "type": "v", "vietnamese": "gặp phải"},
    {"word": "counter", "type": "v", "vietnamese": "phản bác, chống lại"},
    {"word": "tremendous", "type": "adj", "vietnamese": "to lớn, ghê gớm"},
    {"word": "subsequent", "type": "adj", "vietnamese": "tiếp theo, xảy ra sau"},
    {"word": "empirically", "type": "adv", "vietnamese": "theo cơ sở thực nghiệm"},
    {"word": "encode", "type": "v", "vietnamese": "ghi nhận, mã hóa"},
    {"word": "momentarily", "type": "adv", "vietnamese": "trong chốc lát"},
    {"word": "reside", "type": "v", "vietnamese": "nằm ở, cư trú"},
    {"word": "arduous", "type": "adj", "vietnamese": "gian khổ, khó khăn"},
   {"word": "predecessor", "type": "n", "vietnamese": " người tiền nhiệm, người hoặc vật xuất hiện trước"},
    {"word": "constraint", "type": "n", "vietnamese": "sự hạn chế, giới hạn"},
    {"word": "serendipity", "type": "n", "vietnamese": "sự tình cờ mang lại may mắn"},
    {"word": "domain", "type": "n", "vietnamese": "lĩnh vực, phạm vi"},
    {"word": "fundamentally", "type": "adv", "vietnamese": "về cơ bản, về nền tảng"},
    {"word": "notion", "type": "n", "vietnamese": "khái niệm, quan niệm"},
    {"word": "candidate", "type": "n", "vietnamese": "ứng viên, người/điểm đủ điều kiện"},
    {"word": "provenance", "type": "n", "vietnamese": "nguồn gốc, xuất xứ"},
    {"word": "intellectual", "type": "adj", "vietnamese": "thuộc trí tuệ"},
    {"word": "disregard", "type": "v", "vietnamese": "bỏ qua, không để ý đến"},
    {"word": "prior", "type": "adj", "vietnamese": "trước, trước đó"},
    {"word": "spontaneously", "type": "adv", "vietnamese": "một cách tự phát, tự nhiên"},
    {"word": "endeavor", "type": "n", "vietnamese": "nỗ lực, cố gắng"},
    {"word": "undermine", "type": "v", "vietnamese": "làm suy yếu, làm giảm giá trị"},
    {"word": "cumulative", "type": "adj", "vietnamese": "tích lũy, dồn lại"},
    {"word": "thrive", "type": "v", "vietnamese": "phát triển mạnh, thịnh vượng"},
    {"word": "monumental", "type": "adj", "vietnamese": "đồ sộ, vĩ đại"},
   {"word": "acclaim", "type": "n", "vietnamese": "sự ca ngợi"},
    {"word": "altruism", "type": "n", "vietnamese": "lòng vị tha"},
    {"word": "bound", "type": "adj", "vietnamese": "chắc chắn"},
    {"word": "bleak", "type": "adj", "vietnamese": "ảm đạm"},
    {"word": "custody", "type": "n", "vietnamese": "quyền giám hộ"},
    {"word": "domineering", "type": "adj", "vietnamese": "hống hách"},
    {"word": "egalitarianism", "type": "n", "vietnamese": "chủ nghĩa bình đẳng"},
    {"word": "hierarchical", "type": "adj", "vietnamese": "theo thứ bậc"},
    {"word": "feasible", "type": "adj", "vietnamese": "khả thi"},
    {"word": "sparsely", "type": "adv", "vietnamese": "một cách thưa thớt"},
    {"word": "transcend", "type": "v", "vietnamese": "vượt qua"},
    {"word": "ostracise", "type": "v", "vietnamese": "tẩy chay"},
    {"word": "ulterior", "type": "adj", "vietnamese": "ẩn giấu"}
];

const vocabListKhiem = [
       {"word": "regular", "type": "adj", "vietnamese": "đều đặn, thường xuyên"},
    {"word": "irregular", "type": "adj", "vietnamese": "không đều, không thường xuyên"},
    {"word": "bulk", "type": "n", "vietnamese": "số lượng lớn, khối lượng lớn"},
    {"word": "revenue", "type": "n", "vietnamese": "doanh thu, thu nhập"},
    {"word": "generate", "type": "v", "vietnamese": "tạo ra, phát sinh"},
    {"word": "amateur", "type": "n", "vietnamese": "(kẻ)nghiệp dư"},
    {"word": "reputation", "type": "n", "vietnamese": "danh tiếng"},
    {"word": "access", "type": "n", "vietnamese": "sự truy cập"},
    {"word": "acrobat", "type": "n", "vietnamese": "diễn viên xiếc nhào lộn"},
    {"word": "carpenter", "type": "n", "vietnamese": "thợ mộc"},
    {"word": "roundabout", "type": "n", "vietnamese": "bùng binh, vòng xuyến"},
    {"word": "junction", "type": "n", "vietnamese": "ngã ba/ngã tư, điểm giao nhau"},
    {"word": "entire", "type": "adj", "vietnamese": "toàn bộ"},
    {"word": "vogue", "type": "n", "vietnamese": "mốt, sự thịnh hành"},
    {"word": "urgent", "type": "adj", "vietnamese": "khẩn cấp"},
    {"word": "multi-storey", "type": "adj", "vietnamese": "nhiều tầng"},
    {"word": "construct", "type": "v", "vietnamese": "xây dựng"},
    {"word": "proponent", "type": "n", "vietnamese": "người ủng hộ"},
    {"word": "eventual", "type": "adj", "vietnamese": "cuối cùng"},
       {"word": "release", "type": "v", "vietnamese": "giải phóng, thải ra"},
    {"word": "stilt", "type": "n", "vietnamese": "cột chống (nhà sàn)"},
    {"word": "steep", "type": "adj", "vietnamese": "dốc"},
    {"word": "ventilation", "type": "n", "vietnamese": "sự thông gió"},
    {"word": "structure", "type": "n", "vietnamese": "kết cấu"},
    {"word": "airtight", "type": "adj", "vietnamese": "kín khí"},
    {"word": "industry", "type": "n", "vietnamese": "ngành công nghiệp"},
    {"word": "blame", "type": "v", "vietnamese": "đổ lỗi"},
    {"word": "widespread", "type": "adj", "vietnamese": "phổ biến, rộng rãi"},
    {"word": "superior", "type": "adj", "vietnamese": "vượt trội"},
    {"word": "reject", "type": "v", "vietnamese": "từ chối, bác bỏ"},
    {"word": "self-sufficient", "type": "adj", "vietnamese": "tự cung tự cấp"},
    {"word": "reflect away", "type": "v", "vietnamese": "phản xạ, phản chiếu (tia sáng)"},
    {"word": "ray", "type": "n", "vietnamese": "tia"},
    {"word": "slat", "type": "n", "vietnamese": "thanh lam, tấm bản mỏng"},
    {"word": "innovative", "type": "adj", "vietnamese": "mang tính sáng tạo, đổi mới"},
    {"word": "mould", "type": "v", "vietnamese": "nặn, đúc"},
    {"word": "insulator", "type": "n", "vietnamese": "chất cách nhiệt"},
    {"word": "rough", "type": "adj", "vietnamese": "thô ráp"},
    {"word": "frond", "type": "n", "vietnamese": "lá (cây dương xỉ, cọ)"},
    {"word": "eventual", "type": "adj", "vietnamese": "cuối cùng"},
       {"word": "acquire", "type": "v", "vietnamese": "tiếp thu, học được"},
    {"word": "cope", "type": "v", "vietnamese": "đối phó"},
    {"word": "frightening", "type": "adj", "vietnamese": "đáng sợ"},
    {"word": "physiological", "type": "adj", "vietnamese": "(thuộc) sinh lý"},
    {"word": "psychological", "type": "adj", "vietnamese": "(thuộc) tâm lý"},
    {"word": "compress", "type": "v", "vietnamese": "nén"},
    {"word": "insight", "type": "n", "vietnamese": "sự hiểu biết sâu sắc"},
    {"word": "span", "type": "n", "vietnamese": "khoảng thời gian"},
    {"word": "identify", "type": "v", "vietnamese": "nhận dạng, xác định"},
    {"word": "behavior", "type": "n", "vietnamese": "hành vi"},
    {"word": "determine", "type": "v", "vietnamese": "xác định, quyết định"},
    {"word": "proceed", "type": "v", "vietnamese": "tiến hành"},
    {"word": "stood", "type": "v", "vietnamese": "đứng (quá khứ)"},
    {"word": "cage", "type": "n", "vietnamese": "lồng"},
    {"word": "avoid", "type": "v", "vietnamese": "tránh"},
    {"word": "infant", "type": "n", "vietnamese": "trẻ sơ sinh"},
    {"word": "neutral", "type": "adj", "vietnamese": "trung lập"},
    {"word": "motionless", "type": "adj", "vietnamese": "bất động"},
    {"word": "encounter", "type": "v", "vietnamese": "gặp phải"},
    {"word": "condition", "type": "n", "vietnamese": "tình huống, điều kiện"},
    
       {"word": "hostile", "type": "adj", "vietnamese": "thù địch, hiếu chiến"},
    {"word": "overwhelm", "type": "v", "vietnamese": "làm choáng ngợp, áp đảo"},
    {"word": "terror", "type": "n", "vietnamese": "nỗi kinh hoàng, sự khiếp sợ"},
    {"word": "associate", "type": "v", "vietnamese": "liên kết, gắn với"},
    {"word": "obtain", "type": "v", "vietnamese": "đạt được, thu được"},
    {"word": "undergo", "type": "v", "vietnamese": "trải qua"},
    {"word": "cue", "type": "n", "vietnamese": "tín hiệu, dấu hiệu"},
    {"word": "elicit", "type": "v", "vietnamese": "gợi ra, khơi gợi"},
    {"word": "assume", "type": "v", "vietnamese": "cho rằng, giả định"},
    {"word": "emit", "type": "v", "vietnamese": "phát ra, bốc ra"},
    {"word": "deduce", "type": "v", "vietnamese": "suy ra, suy luận"},
    {"word": "regain", "type": "v", "vietnamese": "lấy lại, giành lại"},
    {"word": "closeness", "type": "n", "vietnamese": "sự gần gũi"},
    {"word": "extend", "type": "v", "vietnamese": "kéo dài, mở rộng"},
    {"word": "evoke", "type": "v", "vietnamese": "gợi lên"},
    {"word": "gesture", "type": "n", "vietnamese": "cử chỉ"},
    {"word": "cab", "type": "n", "vietnamese": "taxi"},
   {"word": "rent", "type": "n", "vietnamese": "thuê"},
    {"word": "hire", "type": "n", "vietnamese": "thuê"},
    {"word": "fear", "type": "n", "vietnamese": "sợ hãi"},
    {"word": "analysis", "type": "n", "vietnamese": "sự phân tích"},
    {"word": "treat", "type": "v", "vietnamese": "điều trị"},
    {"word": "solitary", "type": "adj", "vietnamese": "cô độc"},
    {"word": "peer", "type": "n", "vietnamese": "bạn cùng trang lứa"},
    {"word": "directly", "type": "adv", "vietnamese": "một cách trực tiếp"},
    {"word": "primate", "type": "n", "vietnamese": "động vật linh trưởng"},
    {"word": "gentle", "type": "adj", "vietnamese": "nhẹ nhàng"},
    {"word": "purse", "type": "v", "vietnamese": "mím (môi)"},
    {"word": "yearn", "type": "v", "vietnamese": "khao khát"},
    {"word": "spot", "type": "v", "vietnamese": "phát hiện"},
    {"word": "bark", "type": "v", "vietnamese": "sủa"},
    {"word": "force", "type": "v", "vietnamese": "ép buộc"},
    {"word": "submissive", "type": "adj", "vietnamese": "phục tùng"},
    {"word": "grimace", "type": "n", "vietnamese": "nét nhăn mặt"},
    {"word": "surmise", "type": "v", "vietnamese": "phỏng đoán"},
    {"word": "emerge", "type": "v", "vietnamese": "xuất hiện"},
    {"word": "critical", "type": "adj", "vietnamese": "then chốt"},
    {"word": "engage", "type": "v", "vietnamese": "tham gia"},
    {"word": "abdomen", "type": "n", "vietnamese": "bụng"}
];
// Hardcoded login credentials
const credentials = {
  khanh: "1234",
  khiem: "1234"
};

let currentVocabList = [];
let unseenWords = [];
let wrongQueue = [];
let currentWord = null;
let score = 0;
let hintIndex = 0;
let currentAttempt = 0;

// DOM Elements for login screen
const loginScreen = document.getElementById("login-screen");
const usernameInput = document.getElementById("username");
const passwordInput = document.getElementById("password");
const loginBtn = document.getElementById("login-btn");
const loginFeedback = document.getElementById("login-feedback");

// DOM Elements for quiz screen
const quizScreen = document.getElementById("quiz-screen");
const progressEl = document.getElementById("progress");
const vietnameseEl = document.getElementById("vietnamese");
const wordInput = document.getElementById("wordInput");
const typeInput = document.getElementById("typeInput");
const checkBtn = document.getElementById("check-btn");
const skipBtn = document.getElementById("skip-btn");
const feedbackEl = document.getElementById("feedback");

// Hai nút "gợi ý" mới và hai ô hiển thị gợi ý
const wordHintBtn = document.getElementById("word-hint-btn");
const letterHintEl = document.getElementById("letter-hint");
const typeHintBtn = document.getElementById("type-hint-btn");
const typeHintEl = document.getElementById("type-hint");

// Audio elements for sound effects
const correctSound = document.getElementById("correct-sound");
const wrongSound = document.getElementById("wrong-sound");

// Login function
function loginFunction() {
  const username = usernameInput.value.trim().toLowerCase();
  const password = passwordInput.value.trim();

  if (!(username in credentials)) {
    loginFeedback.textContent = "Wrong username.";
    loginFeedback.style.color = "red";
    return;
  }
  if (credentials[username] !== password) {
    loginFeedback.textContent = "Wrong password.";
    loginFeedback.style.color = "red";
    return;
  }
  
  loginFeedback.textContent = "Đăng nhập thành công!";
  loginFeedback.style.color = "green";
  // Set the vocabulary list based on the username
  currentVocabList = (username === "khanh") ? vocabListKhanh : (username === "khiem") ? vocabListKhiem : [];
  startExam();
}

// Bind Enter key for login
usernameInput.addEventListener("keydown", function(e) {
  if (e.key === "Enter") loginFunction();
});
passwordInput.addEventListener("keydown", function(e) {
  if (e.key === "Enter") loginFunction();
});
loginBtn.addEventListener("click", loginFunction);

// Quiz event listeners
checkBtn.addEventListener("click", checkAnswer);
skipBtn.addEventListener("click", skipQuestion);

// Gợi ý dần từng chữ cái
wordHintBtn.addEventListener("click", showWordHint);
// Gợi ý loại từ
typeHintBtn.addEventListener("click", showTypeHint);

// Bind Enter key for submitting the answer
wordInput.addEventListener("keydown", function(e) {
  if (e.key === "Enter") checkAnswer();
});
typeInput.addEventListener("keydown", function(e) {
  if (e.key === "Enter") checkAnswer();
});

// Start the quiz after successful login
function startExam() {
  // Hide login screen and show quiz screen
  loginScreen.style.display = "none";
  quizScreen.style.display = "block";
  score = 0;
  unseenWords = [...currentVocabList];
  wrongStack = [];
  progressEl.textContent = `Đã đúng: ${score}/${currentVocabList.length}`;
  nextQuestion();
}

function nextQuestion() {
  // If no more cards, finish
  if (unseenWords.length === 0 && wrongQueue.length === 0) {
    return endQuiz();
  }

  // 1) If there are still unseen words, pick one at random
  if (unseenWords.length > 0) {
    const idx       = Math.floor(Math.random() * unseenWords.length);
    currentWord     = unseenWords.splice(idx, 1)[0];
  }
  // 2) Otherwise, dequeue from the front of wrongQueue
  else {
    currentWord = wrongQueue.shift();
  }

  // Reset hints + attempts
  currentAttempt = 0;
  hintIndex      = 0;

  // Show the Vietnamese meaning
  vietnameseEl.textContent = `Nghĩa: ${currentWord.vietnamese}`;

  // Clear input fields, feedback, and hints
  wordInput.value         = "";
  typeInput.value         = "";
  feedbackEl.textContent  = "";
  letterHintEl.textContent = "";
  typeHintEl.textContent   = "";
  wordInput.classList.remove("error");
  typeInput.classList.remove("error");

  wordInput.focus();
}

function showWordHint() {
  const correctWord = currentWord.word.toLowerCase();
  if (hintIndex < correctWord.length) {
    hintIndex++;
  }
  letterHintEl.textContent = correctWord.substring(0, hintIndex);
}

function showTypeHint() {
  // Hiển thị loại từ một lần (n, v, adj, adv...)
  typeHintEl.textContent = currentWord.type;
}

function skipQuestion() {
  wrongQueue.push(currentWord);
  nextQuestion();
}

function checkAnswer() {
  const userWord    = wordInput.value.trim().toLowerCase();
  const userType    = typeInput.value.trim().toLowerCase();
  const correctWord = currentWord.word.trim().toLowerCase();
  const correctType = currentWord.type.trim().toLowerCase();

  // Remove any old red‐border styling
  wordInput.classList.remove("error");
  typeInput.classList.remove("error");

  const wordIsRight = (userWord === correctWord);
  const typeIsRight = (userType === correctType);

  if (wordIsRight && typeIsRight) {
    // (A) Perfect first try → full point
    if (currentAttempt === 0 && hintIndex === 0) {
      feedbackEl.textContent = "Đúng!";
      feedbackEl.style.color = "green";
      score++;
      progressEl.textContent = `Đã đúng: ${score}/${currentVocabList.length}`;
      correctSound.play();

      // If by any chance it’s still in wrongQueue, remove it
      // const idxInQueue = wrongQueue.indexOf(currentWord);
      // if (idxInQueue !== -1) {
      //   wrongQueue.splice(idxInQueue, 1);
      // }
    }
    // (B) Right after a hint or wrong attempt → no point, re‐enqueue
    else {
      feedbackEl.textContent = "Đúng nhưng không tính điểm vì đã sai/gợi ý. Từ này sẽ xuất hiện lại.";
      feedbackEl.style.color = "orange";
      correctSound.play();
      wrongQueue.push(currentWord);
    }
    nextQuestion();
  } 
  else {
    // (C) At least one field is wrong right now
    if (!wordIsRight) {
      wordInput.classList.add("error");
    }
    if (!typeIsRight) {
      typeInput.classList.add("error");
    }
    currentAttempt++;
    wrongSound.play();
  }
}

function endQuiz() {
  vietnameseEl.textContent = "Kết thúc kiểm tra!";
  feedbackEl.textContent = `Điểm của bạn: ${score}`;
  wordInput.disabled = true;
  typeInput.disabled = true;
}
